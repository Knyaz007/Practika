
<!DOCTYPE html>
<html>
<head>
  <title>Login3</title>
</head>
<body>
  <h1>Login3</h1>

  <form id="loginForm" method="post" action="/tasks/123/comments" >
    <input type="text" name="email" name="Email" required>
    <input type="password" name="password" name="Password" required>
    <input type="submit" value="Login">
  </form>

 <script>
  document.getElementById("loginForm").addEventListener("submit", function (event) {
    event.preventDefault();
    var form = event.target;
    var email = form.querySelector('input[name="email"]').value;
    var password = form.querySelector('input[name="password"]').value;

    fetch("/token", {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    email: email,
    password: password
  })
})
.then(function (response) {
  return response.json();
})
.then(function (data) {
  var accessToken = data.access_token;
  localStorage.setItem("accessToken", accessToken);
  
   //window.location.replace('/users');
   
  // Добавьте следующий код для выполнения запроса к защищенному маршруту после успешной аутентификации
  const token = localStorage.getItem('accessToken');
  const headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer ' + token
  };
   
  // Используйте fetch для выполнения запроса к защищенному маршруту
  fetch('/users', {
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
  .then(response => {
    if (response.ok) {
      // Обработка успешного ответа
	 //  window.location.replace('/users');
	   
    } else {
      throw new Error('Network response was not ok.');
    }
  })
  .catch(error => {
    console.error('There was a problem with the fetch operation:', error);
  });
  
     window.location.href = "/users";
 // window.location.replace('/users');
  
})
.catch(function (error) {
  console.error('Login failed. Please try again.', error);
});
	
  });
 
 
 
 
 
 
 
 
 
  
</script>

   
</body>
</html>
