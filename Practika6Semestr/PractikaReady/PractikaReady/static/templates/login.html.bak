<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
</head>
<body>
  <h1>Login</h1>

  <form id="loginForm" action="/token" method="post">
    <input type="text" name="email" name="Email" required>
    <input type="password" name="password" name="Password" required>
    <input type="submit" value="Login">
  </form>

 <script>
  document.getElementById("loginForm").addEventListener("submit", function (event) {
    event.preventDefault();
    var form = event.target;
    var email = form.querySelector('input[name="email"]').value;
    var password = form.querySelector('input[name="password"]').value;

    fetch("/token", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        email: email,
        password: password
      })
    })
    .then(function (response) {
      return response.json();
    })
    .then(function (data) {
      var accessToken = data.access_token;

      // Save the access token in local storage for later use
      localStorage.setItem("accessToken", accessToken);

      // Redirect to the protected route or perform other actions
      
      // window.location.href = "/users";
	  
      // Добавьте следующий код внутри блока .then, чтобы выполнить запрос к защищенному маршруту только после успешной аутентификации
      const token = localStorage.getItem('accessToken');
      const headers = {
        'Authorization': `Bearer ${token}`
      };

      fetch('/users', { headers })
        .then(response => response.json())
        .then(data => console.log(data));
    })
    .catch(function (error) {
      console.error(error);
      alert("Login failed. Please try again.");
    });
	window.location.href = "/users";
  });

</script>
</body>
</html>
